<!DOCTYPE html>
<html>
<style>
    body {
        font-family: Arial;
    }

    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

    /* Style the buttons inside the tab */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
        background-color: #ddd;
    }

    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
    }

    #helmet_dd {
        width: 150px;
    }

    #neck_dd {
        width: 150px;
    }

    #shoulder_dd {
        width: 150px;
    }

    #back_dd {
        width: 150px;
    }

    #chest_dd {
        width: 150px;
    }

    #wrists_dd {
        width: 150px;
    }

    #hands_dd {
        width: 150px;
    }

    #belt_dd {
        width: 150px;
    }

    #legs_dd {
        width: 150px;
    }

    #boots_dd {
        width: 150px;
    }

    #ring1_dd {
        width: 150px;
    }

    #ring2_dd {
        width: 150px;
    }

    #trinket1_dd {
        width: 150px;
    }

    #trinket2_dd {
        width: 150px;
    }

    #ranged_dd {
        width: 150px;
    }

    #main_hand_dd {
        width: 150px;
    }

    #off_hand_dd {
        width: 150px;
    }

    /*ENCHANTS*/

    #helmet_ench_dd {
        width: 100px;
    }

    #shoulder_ench_dd {
        width: 100px;
    }

    #back_ench_dd {
        width: 100px;
    }

    #chest_ench_dd {
        width: 100px;
    }

    #wrist_ench_dd {
        width: 100px;
    }

    #hands_ench_dd {
        width: 100px;
    }

    #legs_ench_dd {
        width: 100px;
    }

    #boots_ench_dd {
        width: 100px;
    }

    #main_hand_ench_dd {
        width: 100px;
    }

    #off_hand_ench_dd {
        width: 100px;
    }

    select {
        color: black;
    }

    option:disabled {
        color: #cc0000;
    }

    .button {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
    }

    .collapsible {
        background-color: #777;
        color: white;
        cursor: pointer;
        padding: 18px;
        width: 600px;
        border: none;
        text-align: center;
        outline: none;
        font-size: 15px;
    }

    .active, .collapsible:hover {
        background-color: #555;
    }

    .content {
        padding: 18px;
        display: none;
        overflow: hidden;
        width: 600px;
        background-color: #d9d9d9;
    }

    .loader div{
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #003300; /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(180deg); }
        50% { transform: rotate(0deg); }
        75% { transform: rotate(-180deg); }
        100% { transform: rotate(0deg); }
    }
</style>

<head>
    <title>wow fury sim</title>
</head>

<h1>wow fury sim</h1>

<body style="background-color:#bfbfbf;" onload="openTab('event', 'Simulator');">

<div class="tab">
    <button class="tablinks" onclick="openTab(event, 'Simulator')">Simulator</button>
    <button class="tablinks" onclick="openTab(event, 'About')">About</button>
    <button class="tablinks" onclick="openTab(event, 'Equations')">Equations</button>
    <button class="tablinks" onclick="openTab(event, 'Coming soon')">Coming soon</button>
</div>

<div id="About" class="tabcontent">
    <h2>Welcome to my fury simulator!</h2>

    <h3><a href="https://discord.gg/xTuKsRz">Discord link</a></h3>

    <h3>FAQ:</h3>
    <p><b>Q: Is this a spreadsheet? How does it work? </b></p>
    <p> A: No, this is not a spreadsheet. This is an actual simulator with world of warcraft classic mechanics.<br/>
        When the "Run simulator" button is pressed, a character is created, wearing the items, weapons, buffs, and<br/>
        enchants specified by the drop down menus and checkboxes. Then the following values, which are used <br/>
        in the simulator, are computed:<br/>
        - Total attack power<br/>
        - Weapon skill<br/>
        - Hit chance<br/>
        - Haste rating<br/>
        - Weapons extra hit probability<br/>
        - Damage multipliers<br/><br/>
        Where the hit and crit are used to create the following hit tables:<br/>
        - Main-hand white-hit table<br/>
        - Off-hand white-hit table<br/>
        - Two-hand white-hit table (queried for the off-hand when a heroic strike is queued)<br/>
        - Yellow-hit table<br/><br/>
        Then a combat phase starts, where X independent fights are simulated. Here the characters weapons will<br/>
        start to swing towards a target, where white and yellow hits are generated by drawing random samples<br/>
        from the hit-tables. Rage will be generated and spent on abilities following a configurable ability-policy.<br/>
        The DPS can then be computed as the average value of the DPS in these simulations. Furthermore, since the<br/>
        DPS from the simulations approximate a gaussian distribution, one can readily compute the error margins <br/>
        of the expected value (confidence interval). This is crucial in order draw assumptions from the results.<br/>
    </p>
    <p><b>Q: Whats the difference between a simulator and a spreadsheet?</b></p>
    <p>A: A spreadsheet performs no simulations, instead it consists of a mash-up of expected values, where<br/>
        white-hit damage, rage, yellow hits, etc., are modelled. But, since these depend on discrete events, such<br/>
        as cooldowns, flurry charges, rage-capping, swing timer resets (extra hit), the models will be approximate<br/>
        and might thus lack crucial details. I believe people have done a great effort in developing such models,<br/>
        but from the forementioned reasons they will never be as accurate as a simulator!<br/>
    </p>
    <p><b>Q: What equations are used in this simulator?</b></p>
    <p>A: The tables for crit, hit, glancing hits, and weapon skill have all been based on the results presented in<br/>
        the <a href="https://github.com/magey/classic-warrior/wiki/Attack-table">Attack table</a> github.<br/>
        Their models have been verified on classic servers, and I can strongly recommend to check it out.<br/>
        I have derived models for rage myself, since the ones available online are inaccurate (try them out for<br/>
        yourself!). To derive models I have sampled data, using different weapons and different targets, and fit a<br/>
        model towards that data. The result is a linear model that matches the sampled data perfectly.<br/>
    </p>
    <p><b>Q: Wow, I really love the webdesign from the 90's! </b></p>
    <p>A: Said no one ever...<br/>
        The reason why this page looks to have a target audience in their 50's is that I have very limited<br/>
        experience with any web based programming languages. I found something that I understood and stuck to that.<br/>
        And it works, hey! However, the C++ based simulator and the derivation/interpretation of the results should<br/>
        be of higher quality, since they are closed to my field of expertise<br/>
    </p>
</div>

<div id="Equations" class="tabcontent">
    <h2>Details about the simulator will be coming soon!</h2>
</div>

<div id="Coming soon" class="tabcontent">
    <h2>Stuff to be added soon:</h2>
    <p>TPS calculator for tanking. </p>
    <p>Buff configuration for horde side. </p>
    <p>Talents </p>
    <p>Increased simulator configurations</p>
    <p>Boss selection. (for unique fights such as Vaelstrasz) </p>
    <p>Ability to compare gear setups side-by-side </p>
</div>

<div id="Simulator" class="tabcontent">

    <b>Load config from file:</b><br/>
    <input type="file" id="myFile" name="filename" accept=".txt">
    <input type="submit" onclick="load_file()"><br/><br/>

    <b>Save config to file:</b><br/>
    <button onclick="save_button()">Save current config</button>
    <br/><br/>

    <b> Presets:</b><br/>
    <button onclick="load_p1prebis()">Phase 1 "pre-BiS"</button>
    <br/><br/>

    <b> Select armor:</b><br/>

    <!--armor begin-->
    <select id="helmet_dd">
        <option value="none" selected disabled>helmet</option>
        <option value="crown_of_destruction">crown_of_destruction</option>
        <option value="expert_goldminers_head">expert_goldminers_head</option>
        <option value="eye_of_rend">eye_of_rend</option>
        <option value="field_marshals_plate_helm">field_marshals_plate_helm</option>
        <option value="fury_visor">fury_visor</option>
        <option value="helm_of_endless_rage">helm_of_endless_rage</option>
        <option value="helm_of_the_executioner">helm_of_the_executioner</option>
        <option value="helm_of_valor">helm_of_valor</option>
        <option value="lieutenant_commanders_plate_helm">lieutenant_commanders_plate_helm</option>
        <option value="lionheart_helm">lionheart_helm</option>
        <option value="mask_of_the_unforgiven">mask_of_the_unforgiven</option>
    </select>

    <select id="neck_dd">
        <option value="none" selected disabled>neck</option>
        <option value="amulet_of_the_darkmoon">amulet_of_the_darkmoon</option>
        <option value="barbed_choker">barbed_choker</option>
        <option value="imperial_jewel">imperial_jewel</option>
        <option value="mark_of_fordring">mark_of_fordring</option>
        <option value="onyxia_tooth_pendant">onyxia_tooth_pendant</option>
        <option value="prestors_talisman_of_connivery">prestors_talisman_of_connivery</option>
        <option value="the_eye_of_hakkar">the_eye_of_hakkar</option>
    </select>

    <select id="shoulder_dd">
        <option value="none" selected disabled>shoulder</option>
        <option value="black_dragonscale_shoulders">black_dragonscale_shoulders</option>
        <option value="chitinous_shoulderguards">chitinous_shoulderguards</option>
        <option value="conquerors_spaulders">conquerors_spaulders</option>
        <option value="drake_talon_pauldrons">drake_talon_pauldrons</option>
        <option value="field_marshals_plate_shoulderguards">field_marshals_plate_shoulderguards</option>
        <option value="flamescarred_shoulders">flamescarred_shoulders</option>
        <option value="lieutenant_commanders_plate_shoulders">lieutenant_commanders_plate_shoulders</option>
        <option value="mantle_of_wicked_revenge">mantle_of_wicked_revenge</option>
        <option value="razorsteel_shoulders">razorsteel_shoulders</option>
        <option value="spaulders_of_valor">spaulders_of_valor</option>
        <option value="truestrike_shoulders">truestrike_shoulders</option>
        <option value="wyrmhide_spaulders">wyrmhide_spaulders</option>
    </select>

    <p></p>

    <select id="back_dd">
        <option value="none" selected disabled>back</option>
        <option value="blackveil_cloak">blackveil_cloak</option>
        <option value="cape_of_the_black_baron">cape_of_the_black_baron</option>
        <option value="cloak_of_concentrated_hate">cloak_of_concentrated_hate</option>
        <option value="cloak_of_draconic_might">cloak_of_draconic_might</option>
        <option value="cloak_of_firemaw">cloak_of_firemaw</option>
        <option value="cloak_of_the_shrouded_mists">cloak_of_the_shrouded_mists</option>
        <option value="deathguards_cloak">deathguards_cloak</option>
        <option value="puissant_cape">puissant_cape</option>
        <option value="stoneskin_gargoyle_cape">stoneskin_gargoyle_cape</option>
    </select>

    <select id="chest_dd">
        <option value="none" selected disabled>chest</option>
        <option value="black_dragonscale_chest">black_dragonscale_chest</option>
        <option value="breastplate_of_bloodthirst">breastplate_of_bloodthirst</option>
        <option value="breastplate_of_the_chromatic_flight">breastplate_of_the_chromatic_flight</option>
        <option value="breastplate_of_valor">breastplate_of_valor</option>
        <option value="breatplate_of_annihilation">breatplate_of_annihilation</option>
        <option value="cadaverous_armor">cadaverous_armor</option>
        <option value="conquerors_breastplate">conquerors_breastplate</option>
        <option value="deathdealer_breastplate">deathdealer_breastplate</option>
        <option value="field_marshals_plate_armor">field_marshals_plate_armor</option>
        <option value="knight_captains_plate_hauberk">knight_captains_plate_hauberk</option>
        <option value="malfurions_blessed_bulwark">malfurions_blessed_bulwark</option>
        <option value="ogre_forged_hauberk">ogre_forged_hauberk</option>
        <option value="runed_bloodstaind_hauberk">runed_bloodstaind_hauberk</option>
        <option value="savage_gladiator_chain">savage_gladiator_chain</option>
        <option value="tombstone_breastplate">tombstone_breastplate</option>
        <option value="vest_of_swift_execution">vest_of_swift_execution</option>
    </select>

    <select id="wrists_dd">
        <option value="none" selected disabled>wrists</option>
        <option value="battleborn_armbraces">battleborn_armbraces</option>
        <option value="berserker_bracers">berserker_bracers</option>
        <option value="blinkstrike">blinkstrike</option>
        <option value="bracers_of_brutality">bracers_of_brutality</option>
        <option value="hive_defiler_wristguards">hive_defiler_wristguards</option>
        <option value="quiraji_execution_bracers">quiraji_execution_bracers</option>
        <option value="vambraces_of_the_sadist">vambraces_of_the_sadist</option>
        <option value="wristguards_of_stability">wristguards_of_stability</option>
        <option value="wristhuards_of_true_flight">wristhuards_of_true_flight</option>
        <option value="zandalar_armguards">zandalar_armguards</option>
    </select>

    <p></p>

    <select id="hands_dd">
        <option value="none" selected disabled>hands</option>
        <option value="aged_core_leather_gloves">aged_core_leather_gloves</option>
        <option value="bloodmail_gauntlets">bloodmail_gauntlets</option>
        <option value="devilsaur_gauntlets">devilsaur_gauntlets</option>
        <option value="edgemasters_handguards">edgemasters_handguards</option>
        <option value="flameguard_gauntlets">flameguard_gauntlets</option>
        <option value="gauntlets_of_annihilation">gauntlets_of_annihilation</option>
        <option value="gauntlets_of_might">gauntlets_of_might</option>
        <option value="gauntlets_of_valor">gauntlets_of_valor</option>
        <option value="gloves_of_enforcement">gloves_of_enforcement</option>
        <option value="kngiht_lietenants_plate_gauntlets">kngiht_lietenants_plate_gauntlets</option>
        <option value="marshals_plate_gauntlets">marshals_plate_gauntlets</option>
        <option value="reiver_claws">reiver_claws</option>
        <option value="sacrificial_gauntlets">sacrificial_gauntlets</option>
    </select>

    <select id="belt_dd">
        <option value="none" selected disabled>belt</option>
        <option value="brigam_girdle">brigam_girdle</option>
        <option value="defilers_plate_girdle">defilers_plate_girdle</option>
        <option value="frostwolf_plate_belt">frostwolf_plate_belt</option>
        <option value="girdle_of_the_fallen_crusader">girdle_of_the_fallen_crusader</option>
        <option value="mugglers_belt">mugglers_belt</option>
        <option value="omokks_girth_restrainer">omokks_girth_restrainer</option>
        <option value="onslaught_girdle">onslaught_girdle</option>
        <option value="therazanes_link">therazanes_link</option>
        <option value="zandalar_vindicators_belt">zandalar_vindicators_belt</option>
    </select>

    <select id="legs_dd">
        <option value="none" selected disabled>legs</option>
        <option value="black_dragonscale_leggings">black_dragonscale_leggings</option>
        <option value="blademaster_leggings">blademaster_leggings</option>
        <option value="bloodsoaked_legplates">bloodsoaked_legplates</option>
        <option value="cloudkeeper_legplates">cloudkeeper_legplates</option>
        <option value="conquerors_legguards">conquerors_legguards</option>
        <option value="devilsaur_leggings">devilsaur_leggings</option>
        <option value="eldritch_legplates">eldritch_legplates</option>
        <option value="handcrafted_mastersmith_leggings">handcrafted_mastersmith_leggings</option>
        <option value="knight_captains_plate_leggings">knight_captains_plate_leggings</option>
        <option value="legguards_of_the_fallen_crusader">legguards_of_the_fallen_crusader</option>
        <option value="legplates_of_the_qiraji_command">legplates_of_the_qiraji_command</option>
        <option value="legplates_of_valor">legplates_of_valor</option>
        <option value="marshals_plate_legguards">marshals_plate_legguards</option>
        <option value="scaled_sand_reaver_leggings">scaled_sand_reaver_leggings</option>
        <option value="titanic_leggings">titanic_leggings</option>
    </select>

    <p></p>

    <select id="boots_dd">
        <option value="none" selected disabled>boots</option>
        <option value="battlechasers_greaves">battlechasers_greaves</option>
        <option value="black_dragonscale_boots">black_dragonscale_boots</option>
        <option value="bloodmail_boots">bloodmail_boots</option>
        <option value="boots_of_the_shadow_flame">boots_of_the_shadow_flame</option>
        <option value="boots_of_the_vanguard">boots_of_the_vanguard</option>
        <option value="chromatic_boots">chromatic_boots</option>
        <option value="knight_lieutenants_greaves">knight_lieutenants_greaves</option>
        <option value="marshals_plate_boots">marshals_plate_boots</option>
        <option value="sapphirons_scale_boots">sapphirons_scale_boots</option>
        <option value="windreaver_greaves">windreaver_greaves</option>
    </select>

    <select id="ring1_dd">
        <option value="none" selected disabled>ring1</option>
        <option value="band_of_accuria">band_of_accuria</option>
        <option value="band_of_the_ogre_king">band_of_the_ogre_king</option>
        <option value="blackstone_ring">blackstone_ring</option>
        <option value="circle_of_applied_force">circle_of_applied_force</option>
        <option value="don_julios_band">don_julios_band</option>
        <option value="magnis_will">magnis_will</option>
        <option value="master_dragonslayers_ring">master_dragonslayers_ring</option>
        <option value="painweaver_band">painweaver_band</option>
        <option value="quick_strike_ring">quick_strike_ring</option>
        <option value="seal_of_the_gurubashi_berserker">seal_of_the_gurubashi_berserker</option>
        <option value="tarnished_elven_ring">tarnished_elven_ring</option>
    </select>

    <select id="ring2_dd">
        <option value="none" selected disabled>ring2</option>
        <option value="band_of_accuria">band_of_accuria</option>
        <option value="band_of_the_ogre_king">band_of_the_ogre_king</option>
        <option value="blackstone_ring">blackstone_ring</option>
        <option value="circle_of_applied_force">circle_of_applied_force</option>
        <option value="don_julios_band">don_julios_band</option>
        <option value="magnis_will">magnis_will</option>
        <option value="master_dragonslayers_ring">master_dragonslayers_ring</option>
        <option value="painweaver_band">painweaver_band</option>
        <option value="quick_strike_ring">quick_strike_ring</option>
        <option value="seal_of_the_gurubashi_berserker">seal_of_the_gurubashi_berserker</option>
        <option value="tarnished_elven_ring">tarnished_elven_ring</option>
    </select>

    <p></p>

    <select id="trinket1_dd">
        <option value="none" selected disabled>trinket1</option>
        <option value="blackhands_breadth">blackhands_breadth</option>
        <option value="counterattack_lodestone">counterattack_lodestone</option>
        <option value="darkmoon_card_maelstrom">darkmoon_card_maelstrom</option>
        <option value="diamond_flask">diamond_flask</option>
        <option value="drake_fang_talisman">drake_fang_talisman</option>
        <option value="hand_of_justice">hand_of_justice</option>
        <option value="rune_of_the_guard_captain">rune_of_the_guard_captain</option>
    </select>

    <select id="trinket2_dd">
        <option value="none" selected disabled>trinket2</option>
        <option value="blackhands_breadth">blackhands_breadth</option>
        <option value="counterattack_lodestone">counterattack_lodestone</option>
        <option value="darkmoon_card_maelstrom">darkmoon_card_maelstrom</option>
        <option value="diamond_flask">diamond_flask</option>
        <option value="drake_fang_talisman">drake_fang_talisman</option>
        <option value="hand_of_justice">hand_of_justice</option>
        <option value="rune_of_the_guard_captain">rune_of_the_guard_captain</option>
    </select>

    <select id="ranged_dd">
        <option value="none" selected disabled>ranged</option>
        <option value="blastershot">blastershot</option>
        <option value="bloodseeker">bloodseeker</option>
        <option value="crossbow_of_imminent_doom">crossbow_of_imminent_doom</option>
        <option value="dragonbreath_hand_cannon">dragonbreath_hand_cannon</option>
        <option value="gurubashi_dwarf_cannon">gurubashi_dwarf_cannon</option>
        <option value="heartstriker">heartstriker</option>
        <option value="larvae_of_the_great_worm">larvae_of_the_great_worm</option>
        <option value="precisely_calibrated_boomstick">precisely_calibrated_boomstick</option>
        <option value="riphook">riphook</option>
        <option value="satyrs_bow">satyrs_bow</option>
        <option value="strikers_mark">strikers_mark</option>
    </select>

    <p></p>

    <b> Select weapons:</b><br/>
    <select id="main_hand_dd">
        <option value="none" selected disabled>main_hand</option>
        <option value="none" disabled> --- SWORDS ---</option>
        <option value="ancient_quiraj_ripper">ancient_quiraj_ripper</option>
        <option value="assassination_blade">assassination_blade</option>
        <option value="brutality_blade">brutality_blade</option>
        <option value="chromatically_tempered_sword">chromatically_tempered_sword</option>
        <option value="dal_rends_sacred_charge">dal_rends_sacred_charge</option>
        <option value="dal_rends_tribal_guardian">dal_rends_tribal_guardian</option>
        <option value="grand_marshals_longsword">grand_marshals_longsword</option>
        <option value="grand_marshals_swiftblade">grand_marshals_swiftblade</option>
        <option value="maladath">maladath</option>
        <option value="mirahs_song">mirahs_song</option>
        <option value="protectors_sword">protectors_sword</option>
        <option value="quel_serrar">quel_serrar</option>
        <option value="teebus_blazing_longsword">teebus_blazing_longsword</option>
        <option value="thrash_blade">thrash_blade</option>
        <option value="thunderfury_blessed_blade">thunderfury_blessed_blade</option>
        <option value="viskag">viskag</option>
        <option value="warblade_hakkari_mh">warblade_hakkari_mh</option>
        <option value="warblade_hakkari_oh">warblade_hakkari_oh</option>
        <option value="none" disabled> --- AXES ---</option>
        <option value="ancient_hakkari_manslayer">ancient_hakkari_manslayer</option>
        <option value="axe_of_the_deep_woods">axe_of_the_deep_woods</option>
        <option value="crul_shorukh_edge_of_chaos">crul_shorukh_edge_of_chaos</option>
        <option value="deathbringer">deathbringer</option>
        <option value="dooms_edge">dooms_edge</option>
        <option value="flurry_axe">flurry_axe</option>
        <option value="frostbite">frostbite</option>
        <option value="grand_marshals_handaxe">grand_marshals_handaxe</option>
        <option value="none" disabled> --- DAGGERS ---</option>
        <option value="alcors_sunrazor">alcors_sunrazor</option>
        <option value="core_hound_tooth">core_hound_tooth</option>
        <option value="deaths_sting">deaths_sting</option>
        <option value="dragonfang_blade">dragonfang_blade</option>
        <option value="finkles_skinner">finkles_skinner</option>
        <option value="grand_marshals_dirk">grand_marshals_dirk</option>
        <option value="perditions_blade">perditions_blade</option>
        <option value="none" disabled> --- MACES ---</option>
        <option value="anubisath_warhammer">anubisath_warhammer</option>
        <option value="ebon_hand">ebon_hand</option>
        <option value="empyrean_demolisher">empyrean_demolisher</option>
        <option value="grand_marshals_punisher">grand_marshals_punisher</option>
        <option value="ironfoe">ironfoe</option>
        <option value="mass_of_mcgowan">mass_of_mcgowan</option>
        <option value="sand_polished_hammer">sand_polished_hammer</option>
        <option value="spineshatter">spineshatter</option>
        <option value="stormstike_hammer">stormstike_hammer</option>
        <option value="none" disabled> --- FISTS ---</option>
        <option value="claw_of_the_black_drake">claw_of_the_black_drake</option>
    </select>

    <select id="off_hand_dd">
        <option value="none" selected disabled>off_hand</option>
        <option value="none" disabled> --- SWORDS ---</option>
        <option value="ancient_quiraj_ripper">ancient_quiraj_ripper</option>
        <option value="assassination_blade">assassination_blade</option>
        <option value="brutality_blade">brutality_blade</option>
        <option value="chromatically_tempered_sword">chromatically_tempered_sword</option>
        <option value="dal_rends_sacred_charge">dal_rends_sacred_charge</option>
        <option value="dal_rends_tribal_guardian">dal_rends_tribal_guardian</option>
        <option value="grand_marshals_longsword">grand_marshals_longsword</option>
        <option value="grand_marshals_swiftblade">grand_marshals_swiftblade</option>
        <option value="maladath">maladath</option>
        <option value="mirahs_song">mirahs_song</option>
        <option value="protectors_sword">protectors_sword</option>
        <option value="quel_serrar">quel_serrar</option>
        <option value="teebus_blazing_longsword">teebus_blazing_longsword</option>
        <option value="thrash_blade">thrash_blade</option>
        <option value="thunderfury_blessed_blade">thunderfury_blessed_blade</option>
        <option value="viskag">viskag</option>
        <option value="warblade_hakkari_mh">warblade_hakkari_mh</option>
        <option value="warblade_hakkari_oh">warblade_hakkari_oh</option>
        <option value="none" disabled> --- AXES ---</option>
        <option value="ancient_hakkari_manslayer">ancient_hakkari_manslayer</option>
        <option value="axe_of_the_deep_woods">axe_of_the_deep_woods</option>
        <option value="crul_shorukh_edge_of_chaos">crul_shorukh_edge_of_chaos</option>
        <option value="deathbringer">deathbringer</option>
        <option value="dooms_edge">dooms_edge</option>
        <option value="flurry_axe">flurry_axe</option>
        <option value="frostbite">frostbite</option>
        <option value="grand_marshals_handaxe">grand_marshals_handaxe</option>
        <option value="none" disabled> --- DAGGERS ---</option>
        <option value="alcors_sunrazor">alcors_sunrazor</option>
        <option value="core_hound_tooth">core_hound_tooth</option>
        <option value="deaths_sting">deaths_sting</option>
        <option value="dragonfang_blade">dragonfang_blade</option>
        <option value="finkles_skinner">finkles_skinner</option>
        <option value="grand_marshals_dirk">grand_marshals_dirk</option>
        <option value="perditions_blade">perditions_blade</option>
        <option value="none" disabled> --- MACES ---</option>
        <option value="anubisath_warhammer">anubisath_warhammer</option>
        <option value="ebon_hand">ebon_hand</option>
        <option value="empyrean_demolisher">empyrean_demolisher</option>
        <option value="grand_marshals_punisher">grand_marshals_punisher</option>
        <option value="ironfoe">ironfoe</option>
        <option value="mass_of_mcgowan">mass_of_mcgowan</option>
        <option value="sand_polished_hammer">sand_polished_hammer</option>
        <option value="spineshatter">spineshatter</option>
        <option value="stormstike_hammer">stormstike_hammer</option>
        <option value="none" disabled> --- FISTS ---</option>
        <option value="claw_of_the_black_drake">claw_of_the_black_drake</option>
    </select>

    <!--armor stop-->

    <br/><br/><b> Select enchants:</b><br/>

    <select id="helmet_ench_dd">
        <option value="helmet">helmet</option>
        <option value="+8 strength">+8 strength</option>
        <option value="+1 haste">+1 haste</option>
    </select>

    <select id="shoulder_ench_dd">
        <option value="shoulder">shoulder</option>
        <option value="+30 attack_power">+30 attack power</option>
    </select>

    <select id="back_ench_dd">
        <option value="back">back</option>
        <option value="+3 agility">+3 agility</option>
    </select>

    <select id="chest_ench_dd">
        <option value="back">chest</option>
        <option value="+3 stats">+3 stats</option>
        <option value="+4 stats">+4 stats</option>
    </select>

    <p></p>

    <select id="wrist_ench_dd">
        <option value="wrist">wrist</option>
        <option value="+7 strength">+7 strength</option>
        <option value="+9 strength">+9 strength</option>
    </select>

    <select id="hands_ench_dd">
        <option value="hands">hands</option>
        <option value="+7 agility">+7 agility</option>
        <option value="+7 strength">+7 strength</option>
        <option value="+1 haste">+1 haste</option>
    </select>

    <select id="legs_ench_dd">
        <option value="legs">legs</option>
        <option value="+8 strength">+8 strength</option>
        <option value="+1 haste">+1 haste</option>
    </select>

    <select id="boots_ench_dd">
        <option value="boots">boots</option>
        <option value="+7 agility">+7 agility</option>
    </select>

    <p></p>

    <select id="main_hand_ench_dd">
        <option value="main_hand">weapon</option>
        <option value="crusader">crusader</option>
    </select>

    <select id="off_hand_ench_dd">
        <option value="off_hand">off_hand</option>
        <option value="crusader">crusader</option>
    </select>

    <br/><br/><b> Select race:</b><br/>

    <select id="race_dd">
        <option value="human">human</option>
        <option value="gnome">gnome</option>
        <option value="dwarf">dwarf</option>
        <option value="night_elf">night_elf</option>
        <option value="orc">orc</option>
        <option value="troll">troll</option>
        <option value="undead">undead</option>
        <option value="tauren">tauren</option>
    </select><br/><br/>

    <button type="button" class="collapsible">Open Buffs and Consumables</button>
    <div class="content">
        <b> World buffs:</b><br>
        <input type="checkbox" id="rallying_cry" checked>
        <label for="rallying_cry"> rallying_cry</label><br>

        <input type="checkbox" id="dire_maul" checked>
        <label for="dire_maul"> dire_maul</label><br>

        <input type="checkbox" id="songflower">
        <label for="songflower"> songflower</label><br>

        <input type="checkbox" id="warchiefs_blessing">
        <label for="warchiefs_blessing"> warchiefs_blessing</label><br>

        <input type="checkbox" id="spirit_of_zandalar" checked>
        <label for="spirit_of_zandalar"> spirit_of_zandalar</label><br>

        <input type="checkbox" id="sayges_fortune">
        <label for="sayges_fortune"> sayges_fortune</label><br><br>

        <b> Player buffs:</b><br>
        <input type="checkbox" id="battle_shout" checked>
        <label for="battle_shout"> battle_shout</label><br>

        <input type="checkbox" id="blessing_of_kings" checked>
        <label for="blessing_of_kings"> blessing_of_kings</label><br>

        <input type="checkbox" id="blessing_of_might" checked>
        <label for="blessing_of_might"> blessing_of_might</label><br>

        <input type="checkbox" id="gift_of_the_wild" checked>
        <label for="gift_of_the_wild"> gift_of_the_wild</label><br>

        <input type="checkbox" id="leader_of_the_pack">
        <label for="leader_of_the_pack"> leader_of_the_pack</label><br>

        <input type="checkbox" id="trueshot_aura" checked>
        <label for="trueshot_aura"> trueshot_aura</label><br><br>

        <b> Consumables:</b><br>
        <input type="checkbox" id="elixir_mongoose" checked>
        <label for="elixir_mongoose"> elixir_mongoose</label><br>

        <input type="checkbox" id="blessed_sunfruit" onclick=
                "if (document.getElementById('smoked_dessert_dumplings').checked)
                {
                    document.getElementById('smoked_dessert_dumplings').checked = false;
                }" checked>
        <label for="blessed_sunfruit"> blessed_sunfruit</label><br>

        <input type="checkbox" id="smoked_dessert_dumplings" onclick=
                "if (document.getElementById('blessed_sunfruit').checked)
                {
                    document.getElementById('blessed_sunfruit').checked = false;
                }">
        <label for="smoked_dessert_dumplings"> smoked_dessert_dumplings</label><br>

        <input type="checkbox" id="juju_might" onclick=
                "if (document.getElementById('winterfall_firewater').checked)
                {
                    document.getElementById('winterfall_firewater').checked = false;
                }">
        <label for="juju_might"> juju_might</label><br>

        <input type="checkbox" id="winterfall_firewater" onclick=
                "if (document.getElementById('juju_might').checked)
                {
                    document.getElementById('juju_might').checked = false;
                }">
        <label for="winterfall_firewater"> winterfall_firewater</label><br>

        <input type="checkbox" id="juju_power" onclick=
                "if (document.getElementById('elixir_of_giants').checked)
                {
                    document.getElementById('elixir_of_giants').checked = false;
                }" checked>
        <label for="juju_power"> juju_power</label><br>

        <input type="checkbox" id="elixir_of_giants" onclick=
                "if (document.getElementById('juju_power').checked)
                {
                    document.getElementById('juju_power').checked = false;
                }">
        <label for="elixir_of_giants"> elixir_of_giants</label><br>

        <input type="checkbox" id="roids" checked>
        <label for="roids"> roids</label><br><br>

        <b> Consumables:</b><br>
        <input type="checkbox" id="dense_stone_main_hand" onclick=
                "if (document.getElementById('elemental_stone_main_hand').checked)
                {
                    document.getElementById('elemental_stone_main_hand').checked = false;
                }" checked>
        <label for="dense_stone_main_hand"> dense_stone_main_hand</label><br>

        <input type="checkbox" id="elemental_stone_main_hand" onclick=
                "if (document.getElementById('dense_stone_main_hand').checked)
                {
                    document.getElementById('dense_stone_main_hand').checked = false;
                }">
        <label for="elemental_stone_main_hand"> elemental_stone_main_hand</label><br>

        <input type="checkbox" id="dense_stone_off_hand" onclick=
                "if (document.getElementById('elemental_stone_off_hand').checked)
                {
                    document.getElementById('elemental_stone_off_hand').checked = false;
                }" checked>
        <label for="dense_stone_off_hand"> dense_stone_off_hand</label><br>

        <input type="checkbox" id="elemental_stone_off_hand" onclick=
                "if (document.getElementById('dense_stone_off_hand').checked)
                {
                    document.getElementById('dense_stone_off_hand').checked = false;
                }">
        <label for="elemental_stone_off_hand"> elemental_stone_off_hand</label>
    </div>
    <br/><br/>

    <button type="button" class="collapsible">Open Advanced simulation settings</button>
    <div class="content">
        <label for="n_simulations_dd">Number of simulations: (100 - 30000):</label>
        <input type="number" id="n_simulations_dd" name="quantity" min="100" max="30000" value="10000"><br/>
        <label for="opponent_level_dd">Opponent level: (60-63):</label>
        <input type="number" id="opponent_level_dd" name="quantity" min="60" max="63" value="63"><br/>
        <label for="fight_time_dd">Fight duration: (10-200s):</label>
        <input type="number" id="fight_time_dd" name="quantity" min="10" max="200" value="60"><br/><br/>

        <b>Cooldowns:</b><br/>
        <input type="checkbox" id="enable_death_wish" checked>
        <label for="enable_death_wish"> Use death wish (used in the last 30sec)</label><br>
        <input type="checkbox" id="use_mighty_rage_potion">
        <label for="use_mighty_rage_potion"> Use mighty rage potion (used in the last 25sec)</label><br>
        <input type="checkbox" id="enable_recklessness">
        <label for="enable_recklessness"> Use recklessness (used in the last 20sec)</label><br><br/>

        <b>Armor reduction:</b><br/>
        <label for="sunder_armor_dd">Sunder armor stacks: (0-5):</label>
        <input type="number" id="sunder_armor_dd" name="quantity" min="0" max="5" value="5"><br/>
        <input type="checkbox" id="faerie_fire_feral_active" checked>
        <label for="faerie_fire_feral_active"> Faerie fire feral active</label><br>
        <input type="checkbox" id="curse_of_recklessness_active" checked>
        <label for="curse_of_recklessness_active"> Curse of recklessness active</label><br><br/>

        <b>Combat strategy:</b><br/>
        <input type="checkbox" id="use_bt_in_exec_phase">
        <label for="use_bt_in_exec_phase"> Use bloodthirst in execute phase</label><br>
        <input type="checkbox" id="use_hs_in_exec_phase" checked>
        <label for="use_hs_in_exec_phase"> Use heroic strike in execute phase</label><br>
        <label for="heroic_strike_rage_thresh_dd">Heroic strike when rage is above:</label>
        <input type="number" id="heroic_strike_rage_thresh_dd" name="quantity" min="0" max="100" value="50"><br>
        <label for="whirlwind_rage_thresh_dd">Whirlwind when rage is above:</label>
        <input type="number" id="whirlwind_rage_thresh_dd" name="quantity" min="0" max="100" value="0"><br>
        <label for="whirlwind_bt_cooldown_thresh_dd">Whirlwind when bloodthirst CD is above:</label>
        <input type="number" id="whirlwind_bt_cooldown_thresh_dd" name="quantity" min="0" max="6" value="1.5"><br/><br/>

        <b>Bosses:</b><br/>
        <input type="checkbox" id="vaelastrasz">
        <label for="vaelastrasz"> Fight against Vaelastrasz (essence of the red + initial boss HP = 30%)</label><br>
    </div>

    <p></p>
    <button style="width: 400px; height: 60px;" class="button" data-item-name="itemname">Run simulator
    </button>

    <h2>----------- RESULTS BELOW -----------</h2>
    <div id="loader">
        <div>
        </div>
    </div>
    <p id="output1"></p>
    <p id="output2"></p>
    <p id="output3"></p>
    <p id="output4"></p>

    <canvas id="line-chart-hist"></canvas>

    <p></p>
    <canvas id="line-chart-fight"></canvas>

    <p></p>
    <canvas id="line-chart-fight-cumulative"></canvas>

    <p></p>
    <canvas id="bar-chart-damage"></canvas>

    <p></p>
    <canvas id="bar-chart-auras"></canvas>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.display === "block") {
                content.style.display = "none";
            } else {
                content.style.display = "block";
            }
        });
    }

    function load_file() {
        let file = document.getElementById("myFile");
        var myFile = file.files[0];
        var reader = new FileReader();
        reader.readAsText(myFile);
        reader.onload = function () {
            let rawLog = reader.result;
            let splitlog = rawLog.split("\n");
            for (let item of splitlog) {
                let dd_name = item.split(" ");
                console.log(dd_name[0]);
                if (dd_name.length === 2) {
                    console.log(dd_name[1]);
                    selectElement(dd_name[0], dd_name[1])
                } else {
                    console.log(dd_name[1] + " " + dd_name[2]);
                    selectElement(dd_name[0], dd_name[1] + " " + dd_name[2])
                }
            }
        }
    }

    function selectElement(id, valueToSelect) {
        if (id !== "" && id !== "undefined") {
            if (id.slice(id.length - 2, id.length) === "dd") {
                try {
                    document.getElementById(id).value = valueToSelect;
                } catch (err) {
                    console.log(err);
                }
            } else {
                if (id === valueToSelect) {
                    try {
                        document.getElementById(id).checked = true;
                    } catch (err) {
                        console.log(err);
                    }
                }
            }
        }
    }

    function load_p1prebis() {
        var armor = ["helmet_dd", "neck_dd", "shoulder_dd", "back_dd",
            "chest_dd", "wrists_dd", "hands_dd", "belt_dd", "legs_dd",
            "boots_dd", "ring1_dd", "ring2_dd", "trinket1_dd", "trinket2_dd", "ranged_dd"];
        var items = ["lionheart_helm", "mark_of_fordring", "truestrike_shoulders",
            "cape_of_the_black_baron", "savage_gladiator_chain", "battleborn_armbraces",
            "devilsaur_gauntlets", "omokks_girth_restrainer", "devilsaur_leggings",
            "battlechasers_greaves", "magnis_will", "blackstone_ring",
            "blackhands_breadth", "hand_of_justice", "satyrs_bow"];

        var wep_slots = ["main_hand_dd", "off_hand_dd"];
        var weapons = ["dal_rends_sacred_charge", "dal_rends_tribal_guardian"];

        var armor_ench = ["helmet_ench_dd", "back_ench_dd", "chest_ench_dd", "wrist_ench_dd",
            "hands_ench_dd", "legs_ench_dd", "main_hand_ench_dd", "off_hand_ench_dd"];
        var enchants = ["+8 strength", "+3 agility", "+3 stats", "+9 strength",
            "+7 strength", "+8 strength", "crusader", "crusader"];

        for (let i = 0; i < armor.length; i++) {
            selectElement(armor[i], items[i])
        }
        for (let i = 0; i < weapons.length; i++) {
            selectElement(wep_slots[i], weapons[i])
        }
        for (let i = 0; i < enchants.length; i++) {
            selectElement(armor_ench[i], enchants[i])
        }
    }

    function save_button() {
        read_inputs();
        var file_content = "";
        for (let i = 0; i < armor.length; i++) {
            file_content += armor[i] + " " + armor_input[i] + "\n";
        }
        for (let i = 0; i < weapons.length; i++) {
            file_content += weapons[i] + " " + weapons_input[i] + "\n";
        }
        for (let i = 0; i < enchants.length; i++) {
            let dd_string = enchants_input[i].slice(1, enchants_input[i].length);
            file_content += enchants[i] + " " + dd_string + "\n";
        }
        for (let i = 0; i < world_buffs.length; i++) {
            file_content += world_buffs[i] + " " + world_buffs_input[i] + "\n";
        }
        for (let i = 0; i < buffs.length; i++) {
            file_content += buffs[i] + " " + buffs_input[i] + "\n";
        }
        for (let i = 0; i < consumables.length; i++) {
            file_content += consumables[i] + " " + consumables_input[i] + "\n";
        }

        let var_array = ["n_simulations_dd", "opponent_level_dd", "fight_time_dd", "sunder_armor_dd",
            "heroic_strike_rage_thresh_dd", "whirlwind_rage_thresh_dd", "whirlwind_bt_cooldown_thresh_dd"];
        for (let variable of var_array) {
            file_content += variable + " " + parseFloat(document.getElementById(variable).value) + "\n";
        }

        let var_array2 = ["faerie_fire_feral_active", "curse_of_recklessness_active", "enable_death_wish",
            "enable_recklessness", "enable_recklessness", "use_mighty_rage_potion", "vaelastrasz",
            "use_bt_in_exec_phase", "use_hs_in_exec_phase"];

        for (let variable of var_array2) {
            if (document.getElementById(variable).checked) {
                file_content += variable + " " + variable + "\n";
            }
        }

        file_content += "race_dd" + " " + race_string + "\n";

        uriContent = "data:application/octet-stream," + encodeURIComponent(file_content);
        saveAs(uriContent, "wow-fury-sim-config.txt")
    }

    function saveAs(uri, filename) {
        var link = document.createElement('a');
        if (typeof link.download === 'string') {
            document.body.appendChild(link); // Firefox requires the link to be in the body
            link.download = filename;
            link.href = uri;
            link.click();
            document.body.removeChild(link); // remove the link when done
        } else {
            location.replace(uri);
        }
    }

    function openTab(evt, cityName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(cityName).style.display = "block";
    }

    var world_buffs = ["rallying_cry", "dire_maul", "songflower", "warchiefs_blessing", "spirit_of_zandalar", "sayges_fortune"];
    var world_buffs_input = [];

    var buffs = ["battle_shout", "blessing_of_kings", "blessing_of_might", "gift_of_the_wild", "leader_of_the_pack", "trueshot_aura"];
    var buffs_input = [];

    var consumables = ["elixir_mongoose", "blessed_sunfruit", "smoked_dessert_dumplings", "juju_power", "elixir_of_giants", "winterfall_firewater",
        "juju_might", "roids", "dense_stone_main_hand", "elemental_stone_main_hand", "dense_stone_off_hand", "elemental_stone_off_hand"];
    var consumables_input = [];

    var armor = ["helmet_dd", "neck_dd", "shoulder_dd", "back_dd",
        "chest_dd", "wrists_dd", "hands_dd", "belt_dd", "legs_dd",
        "boots_dd", "ring1_dd", "ring2_dd", "trinket1_dd", "trinket2_dd", "ranged_dd"];
    var armor_input = [];

    var weapons = ["main_hand_dd", "off_hand_dd"];
    var weapons_input = [];

    var enchants = ["helmet_ench_dd", "shoulder_ench_dd", "back_ench_dd", "chest_ench_dd", "wrist_ench_dd",
        "hands_ench_dd", "legs_ench_dd", "boots_ench_dd", "main_hand_ench_dd", "off_hand_ench_dd"];
    var enchant_prefixes = ["e", "s", "b", "c", "w", "h", "l", "b", "m", "o"];
    var enchants_input = [];

    var race;
    var race_string;

    function read_inputs() {
        race = document.getElementById("race_dd");
        race_string = race.options[race.selectedIndex].value;

        world_buffs_input = [];
        for (let world_buff of world_buffs) {
            let temp = document.getElementById(world_buff);
            world_buffs_input.push((temp.checked) ? world_buff : "");
        }
        buffs_input = [];
        for (let buff of buffs) {
            let temp = document.getElementById(buff);
            buffs_input.push((temp.checked) ? buff : "");
        }
        consumables_input = [];
        for (let consumable of consumables) {
            let temp = document.getElementById(consumable);
            consumables_input.push((temp.checked) ? consumable : "");
        }

        armor_input = [];
        for (let armor_piece of armor) {
            let temp = document.getElementById(armor_piece);
            armor_input.push(temp.options[temp.selectedIndex].value);
        }

        weapons_input = [];
        for (let i = 0; i < weapons.length; i++) {
            let temp = document.getElementById(weapons[i]);
            weapons_input.push(temp.options[temp.selectedIndex].value);
        }

        enchants_input = [];
        for (let i = 0; i < enchants.length; i++) {
            let temp = document.getElementById(enchants[i]);
            enchants_input.push(enchant_prefixes[i] + temp.options[temp.selectedIndex].value);
        }
    }

    var needs_cleanup = false;
    var bar_chart_auras;
    var bar_chart_damage;
    var line_chart_hist;
    var line_chart_fight;
    var line_chart_fight_cum;

    function clean_charts() {
        if (needs_cleanup) {
            bar_chart_auras.destroy();
            bar_chart_damage.destroy();
            line_chart_hist.destroy();
            line_chart_fight.destroy();
            line_chart_fight_cum.destroy();
        }
        needs_cleanup = true;
    }

    function show_loader(){
        $("#loader").addClass("loader");
        //event.preventDefault();
    }

    function hide_loader(){
        $("#loader").removeClass("loader");
        //event.preventDefault();
    }

    if($(".button").length) {
        $(".button").click(function(event) {
            show_loader();
            //load the ajax data
            // wait(1);
            setTimeout(myFunction, 100);
            setTimeout(hide_loader, 100);
            //hide_loader();
            event.preventDefault();
        });
    }

    function myFunction() {

        clean_charts();
        read_inputs();

        const armor_vec = new Module.StringList();
        for (armor_piece of armor_input) {
            armor_vec.push_back(armor_piece);
        }

        const weapons_vec = new Module.StringList();
        for (wep of weapons_input) {
            weapons_vec.push_back(wep);
        }

        const buff_vec = new Module.StringList();
        for (buff of world_buffs_input) {
            buff_vec.push_back(buff);
        }
        for (buff of buffs_input) {
            buff_vec.push_back(buff);
        }
        for (buff of consumables_input) {
            buff_vec.push_back(buff);
        }

        const ench_vec = new Module.StringList();
        for (ench of enchants_input) {
            ench_vec.push_back(ench);
        }

        let n_simulations_dd = parseFloat(document.getElementById("n_simulations_dd").value);
        if (isNaN(n_simulations_dd)) {
            n_simulations_dd = 5000;
        }
        n_simulations_dd = Math.min(Math.max(n_simulations_dd, 100), 30000);

        let opponent_level_dd = parseFloat(document.getElementById("opponent_level_dd").value);
        if (isNaN(opponent_level_dd)) {
            opponent_level_dd = 63;
        }
        opponent_level_dd = Math.min(Math.max(opponent_level_dd, 60), 63);

        let fight_time_dd = parseFloat(document.getElementById("fight_time_dd").value);
        if (isNaN(fight_time_dd)) {
            fight_time_dd = 60;
        }
        fight_time_dd = Math.min(Math.max(fight_time_dd, 10), 200);

        let sunder_armor_dd = parseInt(document.getElementById("sunder_armor_dd").value);
        if (isNaN(sunder_armor_dd)) {
            sunder_armor_dd = 5;
        }
        sunder_armor_dd = Math.min(Math.max(sunder_armor_dd, 0), 5);

        let faerie_fire_feral_active = document.getElementById("faerie_fire_feral_active").checked;
        let curse_of_recklessness_active = document.getElementById("curse_of_recklessness_active").checked;
        let enable_death_wish = document.getElementById("enable_death_wish").checked;
        let enable_recklessness = document.getElementById("enable_recklessness").checked;
        let use_mighty_rage_potion = document.getElementById("use_mighty_rage_potion").checked;
        let vaelastrasz = document.getElementById("vaelastrasz").checked;

        let use_bt_in_exec_phase = document.getElementById("use_bt_in_exec_phase").checked;
        let use_hs_in_exec_phase = document.getElementById("use_hs_in_exec_phase").checked;
        let heroic_strike_rage_thresh = parseFloat(document.getElementById("heroic_strike_rage_thresh_dd").value);
        let whirlwind_rage_thresh = parseFloat(document.getElementById("whirlwind_rage_thresh_dd").value);
        let whirlwind_bt_cooldown_thresh = parseFloat(document.getElementById("whirlwind_bt_cooldown_thresh_dd").value);

        const stat_weight_vec = new Module.StringList();
        stat_weight_vec.push_back("crit");
        stat_weight_vec.push_back("hit");
        stat_weight_vec.push_back("haste");
        stat_weight_vec.push_back("skill");

        const race_vec = new Module.StringList();
        race_vec.push_back(race_string);

        let wow_input = {
            race: race_vec,
            armor: armor_vec,
            weapons: weapons_vec,
            buffs: buff_vec,
            enchants: ench_vec,
            stat_weights: stat_weight_vec,
            fight_time: fight_time_dd,
            target_level: opponent_level_dd,
            n_simulations: n_simulations_dd,
            sunder_armor: sunder_armor_dd,
            faerie_fire: faerie_fire_feral_active,
            curse_of_recklessness: curse_of_recklessness_active,
            death_wish: enable_death_wish,
            recklessness: enable_recklessness,
            mighty_rage_potion: use_mighty_rage_potion,
            vaelastrasz: vaelastrasz,
            use_bt_in_exec_phase: use_bt_in_exec_phase,
            use_hs_in_exec_phase: use_hs_in_exec_phase,
            heroic_strike_rage_thresh: heroic_strike_rage_thresh,
            whirlwind_rage_thresh: whirlwind_rage_thresh,
            whirlwind_bt_cooldown_thresh: whirlwind_bt_cooldown_thresh,
        };

        let obj = new Module['Sim_interface']();

        let result = obj.simulate(wow_input);

        document.getElementById("output1").innerHTML = 'Average DPS: <b>' + result['mean_dps'].toFixed(2) + ' &plusmn ' +
            result['std_dps'].toFixed(2) + '</b>, (95% confidence interval)';
        document.getElementById("output3").innerHTML = result['messages'].get(0);

        let stat_weights = [];
        if (result['stat_weights'].size() > 0) {
            let ap_string = result['stat_weights'].get(0);
            ap_string = ap_string.split(" ");
            let dps_per_ap = parseFloat(ap_string[1]) / 100;
            let dps_per_ap_max = (parseFloat(ap_string[1]) + parseFloat(ap_string[2])) / 100;
            let dps_per_ap_min = (parseFloat(ap_string[1]) - parseFloat(ap_string[2])) / 100;
            for (let i = 1; i < result['stat_weights'].size(); i++) {
                let stat_string = result['stat_weights'].get(i);
                stat_string = stat_string.split(" ");
                stat_weights.push({
                    'name': stat_string[0],
                    'value': parseFloat(stat_string[1]) / dps_per_ap,
                    'value_max': Math.max((parseFloat(stat_string[1]) + parseFloat(stat_string[2])) / dps_per_ap_min, 0),
                    'value_min': Math.max((parseFloat(stat_string[1]) - parseFloat(stat_string[2])) / dps_per_ap_max, 0),
                    'negative_value_max': Math.max((parseFloat(stat_string[3]) - parseFloat(stat_string[4])) / -dps_per_ap_min, 0),
                    'negative_value_min': Math.max((parseFloat(stat_string[3]) + parseFloat(stat_string[4])) / -dps_per_ap_max, 0)
                    // 'std': parseFloat(stat_string[2]) / dps_per_ap
                });
            }
        }

        let string = "Stat weights: <br />";
        if (result['stat_weights'].size() > 0) {
            for (let i = 0; i < stat_weights.length; i++) {
                string += "+" + stat_weights[i]['name'] + " gives [<b>" + stat_weights[i]['value_min'].toFixed(2) +
                    " &#8722 " + stat_weights[i]['value_max'].toFixed(2) + "</b>] attack power. <br />";
                string += "-" + stat_weights[i]['name'] + " costs [<b>" + stat_weights[i]['negative_value_min'].toFixed(2) +
                    " &#8722 " + stat_weights[i]['negative_value_max'].toFixed(2) + "</b>] attack power. <br /><br />";
            }
        }
        document.getElementById("output2").innerHTML = string;

        // Crit cap details:
        document.getElementById("output4").innerHTML = result['extra_stats'].get(0);


        let sources = [];
        let sources_names = ["Main hand", "Off hand", "Heroic Strike", "Blood Thirst", "Whirlwind", "Execute", "Item procs"];
        for (let i = 0; i < result['dmg_sources'].size(); i++) {
            sources.push(result['dmg_sources'].get(i));
        }

        let aura_name = [];
        let aura_uptimes = [];
        for (let i = 0; i < result['aura_uptimes'].size(); i++) {
            let aura_string = result['aura_uptimes'].get(i);
            let split_string = aura_string.split(" ");
            aura_name.push(split_string[0]);
            aura_uptimes.push(parseFloat(split_string[1]));
        }

        var aura_list = [];
        for (var j = 0; j < aura_name.length; j++)
            aura_list.push({'name': aura_name[j], 'duration': aura_uptimes[j]});

        aura_list.sort(function (a, b) {
            return ((a.duration > b.duration) ? -1 : ((a.name === b.name) ? 0 : 1));
        });

        for (var k = 0; k < aura_list.length; k++) {
            aura_name[k] = aura_list[k].name;
            aura_uptimes[k] = aura_list[k].duration;
        }

        let colors = ["#3e95cd", "#8e5ea2", "#FFFF00", "#c45850", "#e8c3b9", "#145A32", "#FFFFFF"];
        let damage_name = ["white_mh", "white_oh", "bloodthirst", "execute", "heroic_strike", "whirlwind", "item_hit_effects"];
        let white_mh = [];
        let white_oh = [];
        let bloodthirst = [];
        let execute = [];
        let heroic_strike = [];
        let whirlwind = [];
        let item_hit_effects = [];
        let damage_vec = [white_mh, white_oh, bloodthirst, execute, heroic_strike, whirlwind, item_hit_effects];
        for (let i = 0; i < damage_vec.length; i++) {
            if (i === 0) {
                for (let j = 0; j < result[damage_name[i]].size(); j++) {
                    damage_vec[i].push(result[damage_name[i]].get(j));
                }
            } else {
                for (let j = 0; j < result[damage_name[i]].size(); j++) {
                    damage_vec[i].push(result[damage_name[i]].get(j) + damage_vec[i - 1][j]);
                }
            }
        }

        let cumulative_white_mh = [];
        let cumulative_white_oh = [];
        let cumulative_bloodthirst = [];
        let cumulative_execute = [];
        let cumulative_heroic_strike = [];
        let cumulative_whirlwind = [];
        let cumulative_item_hit_effects = [];
        let cumulative_vec = [cumulative_white_mh, cumulative_white_oh, cumulative_bloodthirst, cumulative_execute,
            cumulative_heroic_strike, cumulative_whirlwind, cumulative_item_hit_effects];
        for (let i = 0; i < cumulative_vec.length; i++) {
            cumulative_vec[i][0] = damage_vec[i][0];
            for (let j = 1; j < damage_vec[i].length; j++) {
                cumulative_vec[i].push(cumulative_vec[i][j - 1] + damage_vec[i][j]);
            }
        }

        let time_stamps = [];
        time_stamps.push(0);
        for (let j = 1; j < damage_vec[0].length; j++) {
            time_stamps.push(time_stamps[j - 1] + .50);
        }

        Chart.defaults.global.defaultFontSize = 36;

        let hist_x = [];
        let hist_y = [];
        for (let i = 0; i < result['hist_x'].size(); i++) {
            hist_x.push(parseInt(result['hist_x'].get(i)));
            hist_y.push(result['hist_y'].get(i));
        }

        line_chart_hist = new Chart(document.getElementById("line-chart-hist"), {
            type: 'line',
            data: {
                labels: hist_x,
                datasets: [{
                    data: hist_y,
                    label: "Simulator results",
                    borderWidth: 10,
                    borderColor: "#3e95cd",
                    fill: origin,
                    backgroundColor: "#3e95cd"
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Damage histogram'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Frequency'
                        }
                    }],
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'DPS'
                        }
                    }]
                }
            }
        });

        let canvas = document.getElementById("line-chart-hist");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';

        line_chart_fight = new Chart(document.getElementById("line-chart-fight"), {
            type: 'line',
            data: {
                labels: time_stamps,
                datasets: [{
                    data: damage_vec[0],
                    label: damage_name[0],
                    borderWidth: 10,
                    borderColor: colors[0],
                    backgroundColor: colors[0],
                    pointRadius: 0.1,
                    fill: origin
                }, {
                    data: damage_vec[1],
                    label: damage_name[1],
                    borderWidth: 10,
                    borderColor: colors[1],
                    backgroundColor: colors[1],
                    pointRadius: 0.1,
                    fill: origin
                }, {
                    data: damage_vec[2],
                    label: damage_name[2],
                    borderWidth: 10,
                    borderColor: colors[2],
                    backgroundColor: colors[2],
                    pointRadius: 0.1,
                    fill: origin
                }, {
                    data: damage_vec[3],
                    label: damage_name[3],
                    borderWidth: 10,
                    borderColor: colors[3],
                    backgroundColor: colors[3],
                    pointRadius: 0.1,
                    fill: origin
                }, {
                    data: damage_vec[4],
                    label: damage_name[4],
                    borderWidth: 10,
                    borderColor: colors[4],
                    backgroundColor: colors[4],
                    pointRadius: 0.1,
                    fill: origin
                }, {
                    data: damage_vec[5],
                    label: damage_name[5],
                    borderWidth: 10,
                    borderColor: colors[5],
                    backgroundColor: colors[5],
                    pointRadius: 0.1,
                    fill: origin
                }, {
                    data: damage_vec[6],
                    label: damage_name[6],
                    borderWidth: 10,
                    borderColor: colors[6],
                    backgroundColor: colors[6],
                    pointRadius: 0.1,
                    fill: origin
                },]
            },
            options: {
                bezierCurve: false,
                title: {
                    display: true,
                    text: 'Fight time lapse (DPS)'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Average damage'
                        }
                    }],
                    xAxes: [{
                        ticks: {
                            autoSkip: true,
                            maxTicksLimit: 30
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Time'
                        }
                    }]
                }
            }
        });

        canvas = document.getElementById("line-chart-fight");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';

        line_chart_fight_cum = new Chart(document.getElementById("line-chart-fight-cumulative"), {
            type: 'line',
            data: {
                labels: time_stamps,
                datasets: [{
                    data: cumulative_vec[0],
                    label: damage_name[0],
                    borderWidth: 10,
                    borderColor: colors[0],
                    backgroundColor: colors[0],
                    pointRadius: 0.1,
                    lineTension: 0,
                    fill: origin
                }, {
                    data: cumulative_vec[1],
                    label: damage_name[1],
                    borderWidth: 10,
                    borderColor: colors[1],
                    backgroundColor: colors[1],
                    pointRadius: 0.1,
                    lineTension: 0,
                    fill: origin
                }, {
                    data: cumulative_vec[2],
                    label: damage_name[2],
                    borderWidth: 10,
                    borderColor: colors[2],
                    backgroundColor: colors[2],
                    pointRadius: 0.1,
                    lineTension: 0,
                    fill: origin
                }, {
                    data: cumulative_vec[3],
                    label: damage_name[3],
                    borderWidth: 10,
                    borderColor: colors[3],
                    backgroundColor: colors[3],
                    pointRadius: 0.1,
                    lineTension: 0,
                    fill: origin
                }, {
                    data: cumulative_vec[4],
                    label: damage_name[4],
                    borderWidth: 10,
                    borderColor: colors[4],
                    backgroundColor: colors[4],
                    pointRadius: 0.1,
                    lineTension: 0,
                    fill: origin
                }, {
                    data: cumulative_vec[5],
                    label: damage_name[5],
                    borderWidth: 10,
                    borderColor: colors[5],
                    backgroundColor: colors[5],
                    pointRadius: 0.1,
                    lineTension: 0,
                    fill: origin
                }, {
                    data: cumulative_vec[6],
                    label: damage_name[6],
                    borderWidth: 10,
                    borderColor: colors[6],
                    backgroundColor: colors[6],
                    pointRadius: 0.1,
                    lineTension: 0,
                    fill: origin
                },]
            },
            options: {
                title: {
                    display: true,
                    text: 'Fight time lapse'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Cumulative damage from source'
                        }
                    }],
                    xAxes: [{
                        ticks: {
                            autoSkip: true,
                            maxTicksLimit: 30
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Time'
                        }
                    }]
                }
            }
        });

        canvas = document.getElementById("line-chart-fight-cumulative");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';

        // Bar chart
        bar_chart_damage = new Chart(document.getElementById("bar-chart-damage"), {
            type: 'bar',
            data: {
                labels: sources_names,
                datasets: [
                    {
                        backgroundColor: colors,
                        data: sources
                    }
                ]
            },
            options: {
                legend: {display: false},
                title: {
                    display: true,
                    text: 'DPS (%) from different sources'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Percentage'
                        }
                    }]
                }
            }
        });

        canvas = document.getElementById("bar-chart-damage");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';

        // Bar chart
        bar_chart_auras = new Chart(document.getElementById("bar-chart-auras"), {
            type: 'bar',
            data: {
                labels: aura_name,
                datasets: [
                    {
                        backgroundColor: colors,
                        data: aura_uptimes
                    }
                ]
            },
            options: {
                legend: {display: false},
                title: {
                    display: true,
                    text: 'Uptime of different auras'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: '%',
                        },
                        ticks:
                            {
                                beginAtZero: true
                            }
                    }]
                }
            }
        });

        canvas = document.getElementById("bar-chart-auras");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';
    }
</script>

<script src="emscripten/wow_interface.js"></script>
</body>
