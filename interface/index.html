<!DOCTYPE html>
<html>
<body style="background-color:#AEB6BF;">

<p> Select armor: </p>

<!--armor begin-->
<select id="helmet_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>helmet</option>
    <option value="crown_of_destruction">crown_of_destruction</option>
    <option value="expert_goldminers_head">expert_goldminers_head</option>
    <option value="helm_of_endless_rage">helm_of_endless_rage</option>
    <option value="lionheart_helm">lionheart_helm</option>
    <option value="mask_of_the_unforgiven">mask_of_the_unforgiven</option>
</select>

<select id="neck_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>neck</option>
    <option value="aq_barbed_choker">aq_barbed_choker</option>
    <option value="mark_of_fordring">mark_of_fordring</option>
    <option value="onyxia_tooth_pendant">onyxia_tooth_pendant</option>
    <option value="prestors_talisman_of_connivery">prestors_talisman_of_connivery</option>
    <option value="the_eye_of_hakkar">the_eye_of_hakkar</option>
</select>

<select id="shoulder_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>shoulder</option>
    <option value="aq_chitinous_shoulderguards">aq_chitinous_shoulderguards</option>
    <option value="aq_conquerors_spaulders">aq_conquerors_spaulders</option>
    <option value="aq_mantle_of_wicked_revenge">aq_mantle_of_wicked_revenge</option>
    <option value="black_dragonscale_shoulders">black_dragonscale_shoulders</option>
    <option value="drake_talon_pauldrons">drake_talon_pauldrons</option>
    <option value="leutenant_shoulders">leutenant_shoulders</option>
    <option value="spaulders_of_valor">spaulders_of_valor</option>
    <option value="truestrike_shoulders">truestrike_shoulders</option>
    <option value="wyrmhide_spaulders">wyrmhide_spaulders</option>
</select>

<select id="back_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>back</option>
    <option value="aq_cloak_of_concentrated_hate">aq_cloak_of_concentrated_hate</option>
    <option value="blackveil_cloak">blackveil_cloak</option>
    <option value="cape_of_the_black_baron">cape_of_the_black_baron</option>
    <option value="cloak_of_draconic_might">cloak_of_draconic_might</option>
    <option value="cloak_of_firemaw">cloak_of_firemaw</option>
</select>

<p></p>

<select id="chest_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>chest</option>
    <option value="aq_breatplate_of_annihilation">aq_breatplate_of_annihilation</option>
    <option value="aq_conquerors_breastplate">aq_conquerors_breastplate</option>
    <option value="aq_vest_of_swift_execution">aq_vest_of_swift_execution</option>
    <option value="black_dragonscale_chest">black_dragonscale_chest</option>
    <option value="breastplate_of_bloodthirst">breastplate_of_bloodthirst</option>
    <option value="cadaverous_armor">cadaverous_armor</option>
    <option value="knight_captains_plate_hauberk">knight_captains_plate_hauberk</option>
    <option value="malfurions_blessed_bulwark">malfurions_blessed_bulwark</option>
    <option value="runed_bloodstaind_hauberk">runed_bloodstaind_hauberk</option>
    <option value="savage_gladiator_chain">savage_gladiator_chain</option>
    <option value="tombstone_breastplate">tombstone_breastplate</option>
</select>

<select id="wrists_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>wrists</option>
    <option value="aq_bracers_of_brutality">aq_bracers_of_brutality</option>
    <option value="aq_hive_defiler_wristguards">aq_hive_defiler_wristguards</option>
    <option value="aq_quiraji_execution_bracers">aq_quiraji_execution_bracers</option>
    <option value="battleborn_armbraces">battleborn_armbraces</option>
    <option value="blinkstrike">blinkstrike</option>
    <option value="vambraces_of_the_sadist">vambraces_of_the_sadist</option>
    <option value="wristguards_of_stability">wristguards_of_stability</option>
    <option value="wristhuards_of_true_flight">wristhuards_of_true_flight</option>
    <option value="zandalar_armguards">zandalar_armguards</option>
</select>

<select id="hands_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>hands</option>
    <option value="aged_core_leather_gloves">aged_core_leather_gloves</option>
    <option value="aq_gauntlets_of_annihilation">aq_gauntlets_of_annihilation</option>
    <option value="aq_gloves_of_enforcement">aq_gloves_of_enforcement</option>
    <option value="bloodmail_gauntlets">bloodmail_gauntlets</option>
    <option value="devilsaur_gauntlets">devilsaur_gauntlets</option>
    <option value="edgemasters_handguards">edgemasters_handguards</option>
    <option value="flameguard_gauntlets">flameguard_gauntlets</option>
    <option value="sacrificial_gauntlets">sacrificial_gauntlets</option>
</select>

<select id="belt_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>belt</option>
    <option value="brigam_girdle">brigam_girdle</option>
    <option value="girdle_of_the_fallen_crusader">girdle_of_the_fallen_crusader</option>
    <option value="mugglers_belt">mugglers_belt</option>
    <option value="omokks_girth">omokks_girth</option>
    <option value="onslaught_girdle">onslaught_girdle</option>
    <option value="thurazane_link">thurazane_link</option>
</select>

<p></p>

<select id="legs_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>legs</option>
    <option value="aq_conquerors_legguards">aq_conquerors_legguards</option>
    <option value="aq_legplates_of_the_qiraji_command">aq_legplates_of_the_qiraji_command</option>
    <option value="aq_scaled_sand_reaver_leggings">aq_scaled_sand_reaver_leggings</option>
    <option value="black_dragonscale_leggings">black_dragonscale_leggings</option>
    <option value="bloodsoaked_legplates">bloodsoaked_legplates</option>
    <option value="cloudkeeper_legplaters">cloudkeeper_legplaters</option>
    <option value="devilsaur_leggings">devilsaur_leggings</option>
    <option value="eldritch_legplates">eldritch_legplates</option>
    <option value="knight_captain_plate_leggings">knight_captain_plate_leggings</option>
    <option value="legguards_of_the_fallen_crusader">legguards_of_the_fallen_crusader</option>
    <option value="titanic_leggings">titanic_leggings</option>
    <option value="ubrs_legs">ubrs_legs</option>
</select>

<select id="boots_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>boots</option>
    <option value="aq_boots_of_the_vanguard">aq_boots_of_the_vanguard</option>
    <option value="battlechasers">battlechasers</option>
    <option value="black_dragonscale_boots">black_dragonscale_boots</option>
    <option value="bloodmail_boots">bloodmail_boots</option>
    <option value="boots_of_shadow_flame">boots_of_shadow_flame</option>
    <option value="chromatic_boots">chromatic_boots</option>
    <option value="knight_leutenants_greaves">knight_leutenants_greaves</option>
    <option value="windreaver_greaves">windreaver_greaves</option>
</select>

<select id="ring_dd1" onchange="read_drop_down()">
    <option value="none" selected disabled>ring1</option>
    <option value="blackstone_ring">blackstone_ring</option>
    <option value="circle_of_applied_force">circle_of_applied_force</option>
    <option value="don_julios_band">don_julios_band</option>
    <option value="magnis_will">magnis_will</option>
    <option value="master_dragonslayers_ring">master_dragonslayers_ring</option>
    <option value="quick_strike_ring">quick_strike_ring</option>
    <option value="tarnished_elven">tarnished_elven</option>
</select>

<select id="ring_dd2" onchange="read_drop_down()">
    <option value="none" selected disabled>ring2</option>
    <option value="blackstone_ring">blackstone_ring</option>
    <option value="circle_of_applied_force">circle_of_applied_force</option>
    <option value="don_julios_band">don_julios_band</option>
    <option value="magnis_will">magnis_will</option>
    <option value="master_dragonslayers_ring">master_dragonslayers_ring</option>
    <option value="quick_strike_ring">quick_strike_ring</option>
    <option value="tarnished_elven">tarnished_elven</option>
</select>

<p></p>

<select id="trinket_dd1" onchange="read_drop_down()">
    <option value="none" selected disabled>trinket1</option>
    <option value="blackhands_breadth">blackhands_breadth</option>
    <option value="diamond_flask">diamond_flask</option>
    <option value="drake_fang_talisman">drake_fang_talisman</option>
    <option value="hand_of_justice">hand_of_justice</option>
</select>

<select id="trinket_dd2" onchange="read_drop_down()">
    <option value="none" selected disabled>trinket2</option>
    <option value="blackhands_breadth">blackhands_breadth</option>
    <option value="diamond_flask">diamond_flask</option>
    <option value="drake_fang_talisman">drake_fang_talisman</option>
    <option value="hand_of_justice">hand_of_justice</option>
</select>

<select id="ranged_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>ranged</option>
    <option value="aq_crossbow_of_imminent_doom">aq_crossbow_of_imminent_doom</option>
    <option value="aq_larvae_of_the_great_worm">aq_larvae_of_the_great_worm</option>
    <option value="blastershot">blastershot</option>
    <option value="bloodseeker">bloodseeker</option>
    <option value="dragonbreath_hand_cannon">dragonbreath_hand_cannon</option>
    <option value="heartstriker">heartstriker</option>
    <option value="precisely_calibrated_boomstick">precisely_calibrated_boomstick</option>
    <option value="riphook">riphook</option>
    <option value="satyrs_bow">satyrs_bow</option>
    <option value="strikers_mark">strikers_mark</option>
</select>

<p> Select weapons: </p>
<select id="main_hand_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>main_hand</option>
    <option value="ancient_hakkari_manslayer">ancient_hakkari_manslayer</option>
    <option value="aq_ancient_quiraj_ripper">aq_ancient_quiraj_ripper</option>
    <option value="aq_anubisath_warhammer">aq_anubisath_warhammer</option>
    <option value="aq_deaths_sting">aq_deaths_sting</option>
    <option value="aq_sand_polished_hammer">aq_sand_polished_hammer</option>
    <option value="assassination_blade">assassination_blade</option>
    <option value="axe_of_the_deep_woods">axe_of_the_deep_woods</option>
    <option value="brutality_blade">brutality_blade</option>
    <option value="chromatically_tempered_sword">chromatically_tempered_sword</option>
    <option value="claw_of_the_black_drake">claw_of_the_black_drake</option>
    <option value="core_hound_tooth">core_hound_tooth</option>
    <option value="crul_shorukh_edge_of_chaos">crul_shorukh_edge_of_chaos</option>
    <option value="dal_rends_sacred_charge">dal_rends_sacred_charge</option>
    <option value="dal_rends_tribal_guardian">dal_rends_tribal_guardian</option>
    <option value="deathbringer">deathbringer</option>
    <option value="dooms_edge">dooms_edge</option>
    <option value="ebon_hand">ebon_hand</option>
    <option value="empyrean_demolisher">empyrean_demolisher</option>
    <option value="grand_marshals_longsword">grand_marshals_longsword</option>
    <option value="grand_marshals_swiftblade">grand_marshals_swiftblade</option>
    <option value="maladath">maladath</option>
    <option value="mirahs_song">mirahs_song</option>
    <option value="quel_serrar">quel_serrar</option>
    <option value="spineshatter">spineshatter</option>
    <option value="stormstike_hammer">stormstike_hammer</option>
    <option value="thrash_blade">thrash_blade</option>
    <option value="viskag">viskag</option>
    <option value="warblade_hakkari_mh">warblade_hakkari_mh</option>
    <option value="warblade_hakkari_oh">warblade_hakkari_oh</option>
</select>

<select id="off_hand_dd" onchange="read_drop_down()">
    <option value="none" selected disabled>off_hand</option>
    <option value="ancient_hakkari_manslayer">ancient_hakkari_manslayer</option>
    <option value="aq_ancient_quiraj_ripper">aq_ancient_quiraj_ripper</option>
    <option value="aq_anubisath_warhammer">aq_anubisath_warhammer</option>
    <option value="aq_deaths_sting">aq_deaths_sting</option>
    <option value="aq_sand_polished_hammer">aq_sand_polished_hammer</option>
    <option value="assassination_blade">assassination_blade</option>
    <option value="axe_of_the_deep_woods">axe_of_the_deep_woods</option>
    <option value="brutality_blade">brutality_blade</option>
    <option value="chromatically_tempered_sword">chromatically_tempered_sword</option>
    <option value="claw_of_the_black_drake">claw_of_the_black_drake</option>
    <option value="core_hound_tooth">core_hound_tooth</option>
    <option value="crul_shorukh_edge_of_chaos">crul_shorukh_edge_of_chaos</option>
    <option value="dal_rends_sacred_charge">dal_rends_sacred_charge</option>
    <option value="dal_rends_tribal_guardian">dal_rends_tribal_guardian</option>
    <option value="deathbringer">deathbringer</option>
    <option value="dooms_edge">dooms_edge</option>
    <option value="ebon_hand">ebon_hand</option>
    <option value="empyrean_demolisher">empyrean_demolisher</option>
    <option value="grand_marshals_longsword">grand_marshals_longsword</option>
    <option value="grand_marshals_swiftblade">grand_marshals_swiftblade</option>
    <option value="maladath">maladath</option>
    <option value="mirahs_song">mirahs_song</option>
    <option value="quel_serrar">quel_serrar</option>
    <option value="spineshatter">spineshatter</option>
    <option value="stormstike_hammer">stormstike_hammer</option>
    <option value="thrash_blade">thrash_blade</option>
    <option value="viskag">viskag</option>
    <option value="warblade_hakkari_mh">warblade_hakkari_mh</option>
    <option value="warblade_hakkari_oh">warblade_hakkari_oh</option>
</select>

<!--armor stop-->

<p> Select enchants: </p>

<select id="helmet_ench_dd" onchange="read_drop_down()">
    <option value="Helmet" selected disabled>Helmet</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
</select>

<select id="weapon_ench_dd" onchange="read_drop_down()">
    <option value="Weapon" selected disabled>Weapon</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
</select>

<h3> Buffs: </h3>
<p> World buffs: </p>
<input type="checkbox" id="rallying_cry" onchange="read_checkboxes()">
<label for="rallying_cry"> rallying_cry</label><br>

<input type="checkbox" id="dire_maul" onchange="read_checkboxes()">
<label for="dire_maul"> dire_maul</label><br>

<input type="checkbox" id="songflower" onchange="read_checkboxes()">
<label for="songflower"> songflower</label><br>

<input type="checkbox" id="warchiefs_blessing" onchange="read_checkboxes()">
<label for="warchiefs_blessing"> warchiefs_blessing</label><br>

<input type="checkbox" id="spirit_of_zandalar" onchange="read_checkboxes()">
<label for="spirit_of_zandalar"> spirit_of_zandalar</label><br>

<input type="checkbox" id="sayges_fortune" onchange="read_checkboxes()">
<label for="sayges_fortune"> sayges_fortune</label><br>

<p> Player buffs: </p>
<input type="checkbox" id="blessing_of_kings" onchange="read_checkboxes()">
<label for="blessing_of_kings"> blessing_of_kings</label><br>

<input type="checkbox" id="blessing_of_might" onchange="read_checkboxes()">
<label for="blessing_of_might"> blessing_of_might</label><br>

<input type="checkbox" id="gift_of_the_wild" onchange="read_checkboxes()">
<label for="gift_of_the_wild"> gift_of_the_wild</label><br>

<input type="checkbox" id="trueshot_aura" onchange="read_checkboxes()">
<label for="trueshot_aura"> trueshot_aura</label><br>

<p> Consumables: </p>
<input type="checkbox" id="elixir_mongoose" onchange="read_checkboxes()">
<label for="elixir_mongoose"> elixir_mongoose</label><br>

<input type="checkbox" id="blessed_sunfruit" onchange="read_checkboxes()">
<label for="blessed_sunfruit"> blessed_sunfruit</label><br>

<input type="checkbox" id="juju_power" onchange="read_checkboxes()">
<label for="juju_power"> juju_power</label><br>

<input type="checkbox" id="juju_might" onchange="read_checkboxes()">
<label for="juju_might"> juju_might</label><br>

<input type="checkbox" id="roids" onchange="read_checkboxes()">
<label for="roids"> roids</label><br>

<form>
    <p>Stone main-hand:</p>
    <input type="radio" id="dense_stone_main_hand" name="gender">
    <label for="dense_stone_main_hand">dense_stone</label><br>
    <input type="radio" id="elemental_stone_main_hand" name="gender">
    <label for="elemental_stone_main_hand">elemental_stone</label><br>
    <input type=button value="Uncheck" onclick=
            "document.getElementById('dense_stone_main_hand').checked = false;
            document.getElementById('elemental_stone_main_hand').checked = false;">
</form>

<form>
    <p>Stone off-hand:</p>
    <input type="radio" id="dense_stone_off_hand" name="gender">
    <label for="dense_stone_off_hand">dense_stone</label><br>
    <input type="radio" id="elemental_stone_off_hand" name="gender">
    <label for="elemental_stone_off_hand">elemental_stone</label><br>
    <input type=button value="Uncheck" onclick=
            "document.getElementById('dense_stone_off_hand').checked = false;
            document.getElementById('elemental_stone_off_hand').checked = false;">
</form>

<h3>Simulation settings:</h3>
<label for="n_simulations">Number of simulations: (between 10 and 100000):</label>
<input type="number" id="n_simulations" name="quantity" min="10" max="100000">

<p></p>
<label for="opponent_level">Opponent level: (60-63):</label>
<input type="number" id="opponent_level" name="quantity" min="60" max="63">

<p></p>
<label for="fight_time">Fight time: (second. 10-300s):</label>
<input type="number" id="fight_time" name="quantity" min="10" max="300">

<p id="button_id"></p>
<button onclick="myFunction()">Run simulator</button>

<p id="output1">Average DPS: </p>
<p id="output2">Character stats: </p>

<canvas id="line-chart-hist"></canvas>

<p></p>
<canvas id="line-chart-fight"></canvas>

<p></p>
<canvas id="bar-chart-damage"></canvas>

<p></p>
<canvas id="bar-chart-auras"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

<script>
    var rallying_cry;
    var rallying_cry_enabled;
    var dire_maul;
    var dire_maul_enabled;
    var songflower;
    var songflower_enabled;
    var warchiefs_blessing;
    var warchiefs_blessing_enabled;
    var spirit_of_zandalar;
    var spirit_of_zandalar_enabled;
    var sayges_fortune;
    var sayges_fortune_enabled;

    var blessing_of_kings;
    var blessing_of_kings_enabled;
    var blessing_of_might;
    var blessing_of_might_enabled;
    var gift_of_the_wild;
    var gift_of_the_wild_enabled;
    var trueshot_aura;
    var trueshot_aura_enabled;

    var elixir_mongoose;
    var elixir_mongoose_enabled;
    var blessed_sunfruit;
    var blessed_sunfruit_enabled;
    var juju_power;
    var juju_power_enabled;
    var juju_might;
    var juju_might_enabled;
    var roids;
    var roids_enabled;

    var dense_stone_main_hand;
    var dense_stone_main_hand_enabled;
    var elemental_stone_main_hand;
    var elemental_stone_main_hand_enabled;
    var dense_stone_off_hand;
    var dense_stone_off_hand_enabled;
    var elemental_stone_off_hand;
    var elemental_stone_off_hand_enabled;

    function read_checkboxes() {
        rallying_cry = document.getElementById("rallying_cry");
        rallying_cry_enabled = (rallying_cry.checked) ? "rallying_cry" : "";

        dire_maul = document.getElementById("dire_maul");
        dire_maul_enabled = (dire_maul.checked) ? "dire_maul" : "";

        songflower = document.getElementById("songflower");
        songflower_enabled = (songflower.checked) ? "songflower" : "";

        warchiefs_blessing = document.getElementById("warchiefs_blessing");
        warchiefs_blessing_enabled = (warchiefs_blessing.checked) ? "warchiefs_blessing" : "";

        spirit_of_zandalar = document.getElementById("spirit_of_zandalar");
        spirit_of_zandalar_enabled = (spirit_of_zandalar.checked) ? "spirit_of_zandalar" : "";

        sayges_fortune = document.getElementById("sayges_fortune");
        sayges_fortune_enabled = (sayges_fortune.checked) ? "sayges_fortune" : "";

        blessing_of_kings = document.getElementById("blessing_of_kings");
        blessing_of_kings_enabled = (blessing_of_kings.checked) ? "blessing_of_kings" : "";

        blessing_of_might = document.getElementById("blessing_of_might");
        blessing_of_might_enabled = (blessing_of_might.checked) ? "blessing_of_might" : "";

        gift_of_the_wild = document.getElementById("gift_of_the_wild");
        gift_of_the_wild_enabled = (gift_of_the_wild.checked) ? "gift_of_the_wild" : "";

        trueshot_aura = document.getElementById("trueshot_aura");
        trueshot_aura_enabled = (trueshot_aura.checked) ? "trueshot_aura" : "";

        elixir_mongoose = document.getElementById("elixir_mongoose");
        elixir_mongoose_enabled = (elixir_mongoose.checked) ? "elixir_mongoose" : "";

        blessed_sunfruit = document.getElementById("blessed_sunfruit");
        blessed_sunfruit_enabled = (blessed_sunfruit.checked) ? "blessed_sunfruit" : "";

        juju_power = document.getElementById("juju_power");
        juju_power_enabled = (juju_power.checked) ? "juju_power" : "";

        juju_might = document.getElementById("juju_might");
        juju_might_enabled = (juju_might.checked) ? "juju_might" : "";

        roids = document.getElementById("roids");
        roids_enabled = (roids.checked) ? "roids" : "";

        dense_stone_main_hand = document.getElementById("dense_stone_main_hand");
        dense_stone_main_hand_enabled = (dense_stone_main_hand.checked) ? "dense_stone_main_hand" : "";

        elemental_stone_main_hand = document.getElementById("elemental_stone_main_hand");
        elemental_stone_main_hand_enabled = (elemental_stone_main_hand.checked) ? "elemental_stone_main_hand" : "";

        dense_stone_off_hand = document.getElementById("dense_stone_off_hand");
        dense_stone_off_hand_enabled = (dense_stone_off_hand.checked) ? "dense_stone_off_hand" : "";

        elemental_stone_off_hand = document.getElementById("elemental_stone_off_hand");
        elemental_stone_off_hand_enabled = (elemental_stone_off_hand.checked) ? "elemental_stone_off_hand" : "";
    }

    var helmet;
    var helmet_string;
    var neck;
    var neck_string;
    var shoulder;
    var shoulder_string;
    var back;
    var back_string;
    var chest;
    var chest_string;
    var wrists;
    var wrists_string;
    var hands;
    var hands_string;
    var belt;
    var belt_string;
    var legs;
    var legs_string;
    var boots;
    var boots_string;
    var rings1;
    var rings1_string;
    var rings2;
    var rings2_string;
    var trinket1;
    var trinket1_string;
    var trinket2;
    var trinket2_string;
    var ranged;
    var ranged_string;
    var main_hand;
    var main_hand_string;
    var off_hand;
    var off_hand_string;

    function read_drop_down() {
        helmet = document.getElementById("helmet_dd");
        helmet_string = helmet.options[helmet.selectedIndex].value;

        neck = document.getElementById("neck_dd");
        neck_string = neck.options[neck.selectedIndex].value;

        shoulder = document.getElementById("shoulder_dd");
        shoulder_string = shoulder.options[shoulder.selectedIndex].value;

        back = document.getElementById("back_dd");
        back_string = back.options[back.selectedIndex].value;

        chest = document.getElementById("chest_dd");
        chest_string = chest.options[chest.selectedIndex].value;

        wrists = document.getElementById("wrists_dd");
        wrists_string = wrists.options[wrists.selectedIndex].value;

        hands = document.getElementById("hands_dd");
        hands_string = hands.options[hands.selectedIndex].value;

        belt = document.getElementById("belt_dd");
        belt_string = belt.options[belt.selectedIndex].value;

        legs = document.getElementById("legs_dd");
        legs_string = legs.options[legs.selectedIndex].value;

        boots = document.getElementById("boots_dd");
        boots_string = boots.options[boots.selectedIndex].value;

        rings1 = document.getElementById("ring_dd1");
        rings1_string = rings1.options[rings1.selectedIndex].value;

        rings2 = document.getElementById("ring_dd2");
        rings2_string = rings2.options[rings2.selectedIndex].value;

        trinket1 = document.getElementById("trinket_dd1");
        trinket1_string = trinket1.options[trinket1.selectedIndex].value;

        trinket2 = document.getElementById("trinket_dd2");
        trinket2_string = trinket2.options[trinket2.selectedIndex].value;

        ranged = document.getElementById("ranged_dd");
        ranged_string = ranged.options[ranged.selectedIndex].value;

        main_hand = document.getElementById("main_hand_dd");
        main_hand_string = main_hand.options[main_hand.selectedIndex].value;

        off_hand = document.getElementById("off_hand_dd");
        off_hand_string = off_hand.options[off_hand.selectedIndex].value;
    }

    var run_before = false;
    var bar_chart_auras;
    var bar_chart_damage;
    var line_chart_hist;

    function clean_charts() {
        if (run_before) {
            bar_chart_auras.destroy();
            bar_chart_damage.destroy();
            line_chart_hist.destroy();
        }
        run_before = true;
    }

    function myFunction() {

        read_drop_down();
        read_checkboxes();
        clean_charts();

        const armor_vec = new Module.StringList();
        armor_vec.push_back(helmet_string);
        armor_vec.push_back(neck_string);
        armor_vec.push_back(shoulder_string);
        armor_vec.push_back(back_string);
        armor_vec.push_back(chest_string);
        armor_vec.push_back(wrists_string);
        armor_vec.push_back(hands_string);
        armor_vec.push_back(belt_string);
        armor_vec.push_back(legs_string);
        armor_vec.push_back(boots_string);
        armor_vec.push_back(rings1_string);
        armor_vec.push_back(rings2_string);
        armor_vec.push_back(trinket1_string);
        armor_vec.push_back(trinket2_string);
        armor_vec.push_back(ranged_string);

        const weapons_vec = new Module.StringList();
        weapons_vec.push_back(main_hand_string);
        weapons_vec.push_back(off_hand_string);

        const buff_vec = new Module.StringList();
        buff_vec.push_back(rallying_cry_enabled);
        buff_vec.push_back(dire_maul_enabled);
        buff_vec.push_back(songflower_enabled);
        buff_vec.push_back(warchiefs_blessing_enabled);
        buff_vec.push_back(spirit_of_zandalar_enabled);
        buff_vec.push_back(sayges_fortune_enabled);
        buff_vec.push_back(blessing_of_kings_enabled);
        buff_vec.push_back(blessing_of_might_enabled);
        buff_vec.push_back(gift_of_the_wild_enabled);
        buff_vec.push_back(trueshot_aura_enabled);
        buff_vec.push_back(elixir_mongoose_enabled);
        buff_vec.push_back(blessed_sunfruit_enabled);
        buff_vec.push_back(juju_power_enabled);
        buff_vec.push_back(juju_might_enabled);
        buff_vec.push_back(roids_enabled);
        buff_vec.push_back(dense_stone_main_hand_enabled);
        buff_vec.push_back(elemental_stone_main_hand_enabled);
        buff_vec.push_back(dense_stone_off_hand_enabled);
        buff_vec.push_back(elemental_stone_off_hand_enabled);

        let n_simulations = parseFloat(document.getElementById("n_simulations").value);
        if (n_simulations != n_simulations) { // Check for NaN
            n_simulations = 5000;
        }

        let opponent_level = parseFloat(document.getElementById("opponent_level").value);
        if (opponent_level != opponent_level) { // Check for NaN
            opponent_level = 63;
        }

        let fight_time = parseFloat(document.getElementById("fight_time").value);
        if (fight_time != fight_time) { // Check for NaN
            fight_time = 60;
        }

        // config.curse_of_recklessness_active = true;
        // config.faerie_fire_feral_active = true;
        // config.n_sunder_armor_stacks = 5;
        // config.use_mighty_rage_potion = true;
        // config.enable_bloodrage = true;
        // config.enable_recklessness = false;
        // config.fuel_extra_rage = false; // Vaelastrasz

        let wow_input = {
            armor: armor_vec,
            weapons: weapons_vec,
            buffs: buff_vec,
            target_level: opponent_level,
            fight_time: fight_time,
            n_simulations: n_simulations
        };

        let obj = new Module['Sim_interface']();

        let result = obj.simulate(wow_input);

        let dps = [];
        for (let i = 0; i < result['dmg_batches'].size(); i++) {
            dps.push(result['dmg_batches'].get(i));
        }
        dps.sort(function (a, b) {
            return a - b
        });

        let n_bins = Math.min(n_simulations, 20);
        let hist_x = [];
        let hist_x_labels = [];
        let hist_y = [];
        let dps_per_bin = (dps[dps.length - 1] - dps[0]) / n_bins;
        let start_dps = dps[0];
        for (let i = start_dps; i <= dps[dps.length - 1] + .01; i += dps_per_bin) {
            hist_x.push(i);
            hist_x_labels.push(i.toFixed(0));
            hist_y.push(0);
        }

        let bin_idx = 0;
        for (let i = 0; i < dps.length; i++) {
            while (dps[i] > hist_x[bin_idx] + dps_per_bin / 2) {
                bin_idx++;
            }
            hist_y[bin_idx]++;
        }

        let sources = [];
        let sources_names = ["Main hand", "Off hand", "Heroic Strike", "Blood Thirst", "Whirlwind", "Execute", "Item procs"];
        for (let i = 0; i < result['dmg_sources'].size(); i++) {
            sources.push(result['dmg_sources'].get(i));
        }

        let aura_name = [];
        let aura_uptimes = [];
        for (let i = 0; i < result['aura_uptimes'].size(); i++) {
            let aura_string = result['aura_uptimes'].get(i);
            let split_string = aura_string.split(" ");
            aura_name.push(split_string[0]);
            aura_uptimes.push(parseFloat(split_string[1]));
        }

        let colors = ["#3e95cd", "#8e5ea2", "#FFFF00", "#c45850", "#e8c3b9", "#145A32", "#FFFFFF"];
        let damage_name = ["white_mh", "white_oh", "bloodthirst", "execute", "heroic_strike", "whirlwind", "item_hit_effects"];
        let white_mh = [];
        let white_oh = [];
        let bloodthirst = [];
        let execute = [];
        let heroic_strike = [];
        let whirlwind = [];
        let item_hit_effects = [];
        let damage_vec = [white_mh, white_oh, bloodthirst, execute, heroic_strike, whirlwind, item_hit_effects];
        for (let i = 0; i < damage_vec.length; i++) {
            if (i === 0) {
                for (let j = 0; j < result[damage_name[i]].size(); j++) {
                    damage_vec[i].push(result[damage_name[i]].get(j));
                }
            } else {
                for (let j = 0; j < result[damage_name[i]].size(); j++) {
                    damage_vec[i].push(result[damage_name[i]].get(j) + damage_vec[i - 1][j]);
                }
            }
            // damage_history_cumulative[i].push(damage_history[i][0]);
            // for (let j = 1; j < damage_history[i].length; j++) {
            //     damage_history_cumulative[i].push(damage_history_cumulative[i][j-1] + damage_history[i][j]);
            // }
        }
        let time_stamps = [];
        time_stamps.push(0);
        for (let j = 1; j < damage_vec[0].length; j++) {
            time_stamps.push(time_stamps[j - 1] + 0.25);
        }

        document.getElementById("output1").innerHTML = 'Average DPS: ' + result['mean_dps'].toFixed(2) + ' +- ' + result['std_dps'].toFixed(2) + ', (95% confidence interval)';
        document.getElementById("output2").innerHTML = result['messages'].get(0);

        Chart.defaults.global.defaultFontSize = 36;

        line_chart_hist = new Chart(document.getElementById("line-chart-hist"), {
            type: 'line',
            data: {
                labels: hist_x_labels,
                datasets: [{
                    data: hist_y,
                    label: "Simulator results",
                    borderWidth: 10,
                    borderColor: "#3e95cd",
                    fill: origin,
                    backgroundColor: "#3e95cd"
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Damage histogram'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Frequency'
                        }
                    }],
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'DPS'
                        }
                    }]
                }
            }
        });

        let canvas = document.getElementById("line-chart-hist");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';

        line_chart_hist = new Chart(document.getElementById("line-chart-fight"), {
            type: 'line',
            data: {
                labels: time_stamps,
                datasets: [{
                    data: damage_vec[0],
                    label: damage_name[0],
                    borderWidth: 10,
                    borderColor: colors[0],
                    backgroundColor: colors[0],
                    fill: origin
                },{
                    data: damage_vec[1],
                    label: damage_name[1],
                    borderWidth: 10,
                    borderColor: colors[1],
                    backgroundColor: colors[1],
                    fill: origin
                },{
                    data: damage_vec[2],
                    label: damage_name[2],
                    borderWidth: 10,
                    borderColor: colors[2],
                    backgroundColor: colors[2],
                    fill: origin
                },{
                    data: damage_vec[3],
                    label: damage_name[3],
                    borderWidth: 10,
                    borderColor: colors[3],
                    backgroundColor: colors[3],
                    fill: origin
                },{
                    data: damage_vec[4],
                    label: damage_name[4],
                    borderWidth: 10,
                    borderColor: colors[4],
                    backgroundColor: colors[4],
                    fill: origin
                },{
                    data: damage_vec[5],
                    label: damage_name[5],
                    borderWidth: 10,
                    borderColor: colors[5],
                    backgroundColor: colors[5],
                    fill: origin
                },{
                    data: damage_vec[6],
                    label: damage_name[6],
                    borderWidth: 10,
                    borderColor: colors[6],
                    backgroundColor: colors[6],
                    fill: origin
                },]
            },
            options: {
                title: {
                    display: true,
                    text: 'Damage histogram'
                }
            }
        });

        canvas = document.getElementById("line-chart-fight");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';

        // Bar chart
        bar_chart_damage = new Chart(document.getElementById("bar-chart-damage"), {
            type: 'bar',
            data: {
                labels: sources_names,
                datasets: [
                    {
                        backgroundColor: colors,
                        data: sources
                    }
                ]
            },
            options: {
                legend: {display: false},
                title: {
                    display: true,
                    text: 'DPS (%) from different sources'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Percentage'
                        }
                    }]
                }
            }
        });

        canvas = document.getElementById("bar-chart-damage");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';

        // Bar chart
        bar_chart_auras = new Chart(document.getElementById("bar-chart-auras"), {
            type: 'bar',
            data: {
                labels: aura_name,
                datasets: [
                    {
                        backgroundColor: ["#3e95cd", "#8e5ea2", "#FFFF00"],
                        data: aura_uptimes
                    }
                ]
            },
            options: {
                legend: {display: false},
                title: {
                    display: true,
                    text: 'DPS (%) from different sources'
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Percentage',
                        },
                        ticks:
                            {
                                beginAtZero: true
                            }
                    }]
                }
            }
        });

        canvas = document.getElementById("bar-chart-auras");
        canvas.maintainAspectRatio = false;
        canvas.style.height = '600px';
        canvas.style.width = '800px';
    }
</script>

<script src="emscripten/wow_interface.js"></script>
</body>
